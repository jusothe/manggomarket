<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>망고마켓 관리자 페이지</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"/>
<link rel="icon" type="image/png" href="logo1-v2.png"/>
<style>
  body { font-family: 'Noto Sans KR', sans-serif; background: #181A1B; color: #fff;}
  .carrot-color { color: #FFB600; }
  .pill { background: #2c2f31; padding: 6px 14px; border-radius: 9999px; margin: 4px; display: inline-flex; align-items: center; gap: 6px; }
  .pill button { color: red; font-size: 12px; }
  .cat-icon { background: #232526; border-radius: 12px; padding: 12px; text-align: center; width: 80px; }
  .cat-icon i { color: #FFB600; font-size: 24px; }
</style>
</head>
<body>

<header class="w-full border-b border-gray-800 bg-[#181A1B] sticky top-0 z-20">
  <div class="max-w-5xl mx-auto flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <img src="logo1-v2.png" alt="망고마켓 로고" class="h-10">
      <span class="text-lg font-bold carrot-color">망고마켓 관리자</span>
    </div>
    <nav class="flex gap-2 flex-wrap">
      <button onclick="showTab('posts')" class="bg-[#FFB600] text-[#181A1B] font-bold px-3 py-1 rounded-full">매물관리</button>
      <button onclick="showTab('users')" class="bg-[#FFB600] text-[#181A1B] font-bold px-3 py-1 rounded-full">회원관리</button>
      <button onclick="showTab('citycat')" class="bg-[#FFB600] text-[#181A1B] font-bold px-3 py-1 rounded-full">도시/카테고리</button>
    </nav>
  </div>
</header>

<main class="max-w-5xl mx-auto p-4 space-y-6">

  <!-- 매물관리 -->
  <div id="tabContent-posts">
    <h2 class="text-lg font-bold carrot-color mb-3">매물 목록</h2>
    <div id="postsTableWrap" class="overflow-x-auto"></div>
  </div>

  <!-- 회원관리 -->
  <div id="tabContent-users" class="hidden">
    <h2 class="text-lg font-bold carrot-color mb-3">회원 목록</h2>
    <div id="usersTableWrap" class="overflow-x-auto"></div>
  </div>

  <!-- 도시/카테고리 -->
  <div id="tabContent-citycat" class="hidden space-y-8">
    <section>
      <h2 class="text-lg font-bold carrot-color mb-3">도시 관리</h2>
      <div id="cityList" class="flex flex-wrap mb-3"></div>
      <form onsubmit="return addCity(event)" class="flex gap-2 flex-wrap">
        <input id="newCityName" class="flex-1 bg-[#232526] text-white p-2 rounded" placeholder="새 도시명">
        <button class="bg-[#FFB600] text-[#181A1B] font-bold px-4 py-2 rounded">추가</button>
      </form>
    </section>

    <section>
      <h2 class="text-lg font-bold carrot-color mb-3">카테고리 관리</h2>
      <div id="catList" class="flex flex-wrap gap-4 mb-3"></div>
      <form onsubmit="return addCat(event)" class="flex gap-2 flex-wrap">
        <input id="newCatName" class="flex-1 bg-[#232526] text-white p-2 rounded" placeholder="새 카테고리명">
        <button class="bg-[#FFB600] text-[#181A1B] font-bold px-4 py-2 rounded">추가</button>
      </form>
    </section>
  </div>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-2ppxdvtaW50-JghD-6pJYN5vngwA1hM",
  authDomain: "manggomarket-f1fd3.firebaseapp.com",
  projectId: "manggomarket-f1fd3",
  storageBucket: "manggomarket-f1fd3.firebasestorage.app",
  messagingSenderId: "511082163569",
  appId: "1:511082163569:web:a68974a1801c8f81271ad0",
  measurementId: "G-XDS0R40SJB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let posts=[], users=[], citys=[], cats=[];

async function loadData(){
  posts = (await getDocs(collection(db,"posts"))).docs.map(d=>({id:d.id,...d.data()}));
  users = (await getDocs(collection(db,"users"))).docs.map(d=>({id:d.id,...d.data()}));
  citys = (await getDocs(collection(db,"citys"))).docs.map(d=>({id:d.id,...d.data()}));
  cats = (await getDocs(collection(db,"cats"))).docs.map(d=>({id:d.id,...d.data()}));
  drawPosts(); drawUsers(); drawCityCat();
}

window.showTab=function(tab){
  document.querySelectorAll('[id^="tabContent-"]').forEach(e=>e.classList.add('hidden'));
  document.getElementById(`tabContent-${tab}`).classList.remove('hidden');
}

function drawPosts(){
  const wrap=document.getElementById('postsTableWrap');
  wrap.innerHTML = posts.length
    ? `<table class="min-w-full text-sm"><tr class="bg-[#232526] text-white"><th class="p-2">ID</th><th class="p-2">제목</th><th class="p-2">도시</th><th class="p-2">카테고리</th></tr>${
      posts.map(p=>`<tr><td class="p-2">${p.id}</td><td class="p-2">${p.title||''}</td><td class="p-2">${p.city||''}</td><td class="p-2">${p.category||''}</td></tr>`).join('')
    }</table>` : `<div class="text-gray-400">매물 없음</div>`;
}

function drawUsers(){
  const wrap=document.getElementById('usersTableWrap');
  wrap.innerHTML = users.length
    ? `<table class="min-w-full text-sm"><tr class="bg-[#232526] text-white"><th class="p-2">ID</th><th class="p-2">닉네임</th><th class="p-2">연락처</th></tr>${
      users.map(u=>`<tr><td class="p-2">${u.id}</td><td class="p-2">${u.nick||''}</td><td class="p-2">${u.phone||''}</td></tr>`).join('')
    }</table>` : `<div class="text-gray-400">회원 없음</div>`;
}

function drawCityCat(){
  document.getElementById('cityList').innerHTML = citys.map((c,i)=>`<span class="pill">${c.name}<button onclick="delCity(${i})">✕</button></span>`).join('');
  document.getElementById('catList').innerHTML = cats.map((c,i)=>`
    <div class="cat-icon">
      <i class="fas fa-tag"></i>
      <span>${c.name}</span>
      <button onclick="delCat(${i})" class="text-red-500 text-xs mt-1">삭제</button>
    </div>`).join('');
}

window.addCity=async function(e){
  e.preventDefault();
  const name=document.getElementById('newCityName').value.trim();
  if(!name) return;
  await setDoc(doc(db,"citys",name),{name});
  document.getElementById('newCityName').value='';
  await loadData();
}
window.addCat=async function(e){
  e.preventDefault();
  const name=document.getElementById('newCatName').value.trim();
  if(!name) return;
  await setDoc(doc(db,"cats",name),{name});
  document.getElementById('newCatName').value='';
  await loadData();
}
window.delCity=async function(i){
  if(confirm('삭제하시겠습니까?')){
    await deleteDoc(doc(db,"citys",citys[i].id));
    await loadData();
  }
}
window.delCat=async function(i){
  if(confirm('삭제하시겠습니까?')){
    await deleteDoc(doc(db,"cats",cats[i].id));
    await loadData();
  }
}

window.addEventListener('load',()=>{loadData();showTab('posts');});
</script>
</body>
</html>

